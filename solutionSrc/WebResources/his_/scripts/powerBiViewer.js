var PowerBiViewer;!function(e){var r;!function(e){function r(){return{restrict:"A",scope:{callback:"&ngOnload"},link:function(e,r,t){var o=r[0].clientWidth,i=r[0].clientHeight;r.on("load",function(r){e.callback({width:o,height:i})})}}}e.onLoadDirective=r}(r=e.Directives||(e.Directives={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(e){var r=function(){function e(r){var t=e.parseQueryString(r);this.powerBi=e.parseCrmDataString(t.data)}return e.create=function(r){return new e(r)},e.parseQueryString=function(e){var r={},t="undefined"==typeof e||null===e?"":e;t=t.length>0&&"?"===t[0]?t.substring(1):t;for(var o=t.split("&"),i=0;i<o.length;i++){var n=o[i].split("=");if("undefined"==typeof this[n[0]])r[n[0]]=n[1];else if("string"==typeof this[n[0]]){var a=[this[n[0]],n[1]];r[n[0]]=a}else r[n[0]].push(n[1])}return r},e.parseCrmDataString=function(e){var r={};if("undefined"==typeof e||null===e||""===e)return r;for(var t=decodeURIComponent(e),o=t.split("&"),i=0;i<o.length;i++){var n=o[i].split("=");if("undefined"==typeof r[n[0]])r[n[0]]=n[1];else if("string"==typeof r[n[0]]){var a=[r[n[0]],n[1]];r[n[0]]=a}else r[n[0]].push(n[1])}return r},e}();e.ConfigService=r}(r=e.Services||(e.Services={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(e){var r=function(){function e(e){this._http=e}return e.prototype.getTile=function(e,r){var t=this;return this.getDashboards().then(function(r){var t=null;return r.forEach(function(r){return r.displayName===e?(t=r,!1):void 0}),t}).then(function(e){return null===e?null:t.getDashboardTiles(e.id)}).then(function(e){var t=null;return e.forEach(function(e){return e.title===r?(t=e,!1):void 0}),t})},e.prototype.getReport=function(e){return this._http.get("https://api.powerbi.com/beta/myorg/reports").then(function(r){var t=null;return r.data.value.forEach(function(r){return r.name===e?(t=r,!1):void 0}),t})},e.prototype.getAllReports=function(){return this._http.get("https://api.powerbi.com/beta/myorg/reports").then(function(e){return e.data.value})},e.prototype.getDashboards=function(){return this._http.get("https://api.powerbi.com/beta/myorg/dashboards").then(function(e){return e.data.value})},e.prototype.getDashboardTiles=function(e){return this._http.get("https://api.powerbi.com/beta/myorg/dashboards/"+e+"/tiles").then(function(e){return e.data.value})},e.$inject=["$http"],e}();e.PowerBiService=r}(r=e.Services||(e.Services={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(e){var r=function(){function e(e,r){var t=this;this._adal=r,e.getDashboards().then(function(r){r.forEach(function(r){e.getDashboardTiles(r.id).then(function(e){r.tiles=e})}),t.dashboards=r}),e.getAllReports().then(function(e){t.reports=e})}return e.$inject=["IPowerBiService","adalAuthenticationService"],e}();e.ConfigController=r}(r=e.Controllers||(e.Controllers={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(e){var r=function(){function e(e,r,t,o,i){var n=this;this._adal=r,this._log=o,"true"===t.isId?this.report={id:t.report,name:"<undefined when using ID>",embedUrl:"https://app.powerbi.com/reportEmbed?reportId="+t.report,webUrl:"https://app.powerbi.com/reports/"+t.report}:e.getReport(t.report).then(function(e){return n.report=e}),i.onmessage=function(e){if(e.data)try{var r=JSON.parse(e.data);"reportClicked"===r.event&&i.open(n.report.webUrl,n.report.id,null,!0)}catch(t){n._log.error("Unable to read message data from Power BI iframe")}}}return e.prototype.sendToken=function(e,r){var t=this;!this.report||!this.report.id||0>=e||0>=r||this._adal.acquireToken("https://analysis.windows.net/powerbi/api").then(function(o){if(null===o||o.length<=0)return void t._log.error("Unable to send access token to report view - no token available");var i=document.getElementById(t.report.id);return i&&i.contentWindow?(t._log.debug("Sending Token"),void i.contentWindow.postMessage(JSON.stringify({action:"loadReport",accessToken:o,width:e,height:r}),"*")):void t._log.error("Unable to send access token to report view - no iframe found with id '"+t.report.id+"'")})["catch"](function(e){t._log.error("Token not available... Message: '"+e+"'")})},e.$inject=["IPowerBiService","adalAuthenticationService","$routeParams","$log","$window"],e}();e.ReportController=r}(r=e.Controllers||(e.Controllers={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(e){var r=function(){function e(e,r,t,o,i){var n=this;this._adal=r,this._log=o,this._window=i,"true"===t.isId?this.tile={id:t.tile,title:"<undefined when using ID>",embedUrl:"https://app.powerbi.com/embed?dashboardId="+t.dashboard+"&tileId="+t.tile}:e.getTile(t.dashboard,t.tile).then(function(e){n.tile=e}),i.onmessage=function(e){if(e.data)try{var r=JSON.parse(e.data);if("tileClicked"===r.event){var t=i.document.getElementById(n.tile.id).src,o=t.split("dashboardId=")[1].split("&")[0],a=t.split("/embed")[0]+"/dashboards/{0}";a=a.replace("{0}",o),i.open(a,n.tile.id,null,!0)}}catch(l){n._log.error("Unable to read message data from Power BI iframe")}}}return e.prototype.sendToken=function(e,r){var t=this;!this.tile||!this.tile.id||0>=e||0>=r||this._adal.acquireToken("https://analysis.windows.net/powerbi/api").then(function(o){if(null===o||o.length<=0)return void t._log.error("Unable to send access token to tile view - no token available");var i=document.getElementById(t.tile.id);return i&&i.contentWindow?(t._log.debug("Sending Token"),void i.contentWindow.postMessage(JSON.stringify({action:"loadTile",accessToken:o,width:e,height:r}),"*")):void t._log.error("Unable to send access token to tile view - no iframe found with id '"+t.tile.id+"'")})["catch"](function(e){t._log.error("Token not available... Message: '"+e+"'")})},e.$inject=["IPowerBiService","adalAuthenticationService","$routeParams","$log","$window"],e}();e.TileController=r}(r=e.Controllers||(e.Controllers={}))}(PowerBiViewer||(PowerBiViewer={}));var PowerBiViewer;!function(e){var r;!function(r){function t(e,r){var t=r.$get();e.when("/",a(t)).when("/config",{templateUrl:o(t,"views/config.html"),controller:"IConfigController",controllerAs:"vm",requireADLogin:!0}).when("/tile/:isId/:dashboard/:tile*",{templateUrl:o(t,"views/tile.html"),controller:"ITileController",controllerAs:"vm",requireADLogin:!0}).when("/report/:isId/:report*",{templateUrl:o(t,"views/report.html"),controller:"IReportController",controllerAs:"vm",requireADLogin:!0}).when("/configerror",{templateUrl:o(t,"views/configerror.html")}).otherwise({redirectTo:"/"})}function o(e,r){return e.location.origin+e.location.pathname.toLowerCase().replace("powerbiviewer.html","")+r}function i(e){var r="undefined"!=typeof e.dashboardId&&"undefined"!=typeof e.tileId;return r||"undefined"!=typeof e.dashboardName&&"undefined"!=typeof e.tileName?"/tile/"+r+"/"+(r?e.dashboardId:e.dashboardName)+"/"+(r?e.tileId:e.tileName):"/configerror"}function n(e){var r="undefined"!=typeof e.reportId;return r||"undefined"!=typeof e.reportName?"/report/"+r+"/"+(r?e.reportId:e.reportName):"/configerror"}function a(r){var t=null,o=e.Services.ConfigService.create(r.location.search);switch(o.powerBi.type){case"tile":t=i(o.powerBi);break;case"report":t=n(o.powerBi);break;default:t="/configerror"}return{redirectTo:t}}function l(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache"}function c(e,r){r.init({tenant:"nordynamics.onmicrosoft.com",clientId:"d976555d-531d-4e3a-b277-4cf309b81ab1",endpoints:{"https://api.powerbi.com":"https://analysis.windows.net/powerbi/api"},cacheLocation:"sessionStorage"},e)}function s(e){e.resourceUrlWhitelist(["self","https://*.crm4.dynamics.com/**","https://*.powerbi.com/**"])}angular.module("powerBiViewerApp",["ngRoute","AdalAngular"]).service("IPowerBiService",e.Services.PowerBiService).service("IConfigService",function(r){return e.Services.ConfigService.create(r.location.search)}).directive("ngOnload",e.Directives.onLoadDirective).controller("ITileController",e.Controllers.TileController).controller("IReportController",e.Controllers.ReportController).controller("IConfigController",e.Controllers.ConfigController).config(l).config(t).config(c).config(s),t.$inject=["$routeProvider","$windowProvider"],l.$inject=["$httpProvider"],c.$inject=["$httpProvider","adalAuthenticationServiceProvider"],s.$inject=["$sceDelegateProvider"]}(r=e.App||(e.App={}))}(PowerBiViewer||(PowerBiViewer={}));